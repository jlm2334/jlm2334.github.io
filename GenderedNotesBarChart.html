<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Bar Graph comparisons</title>
		<script type="text/javascript" src="../d3.js"></script>
		<style type="text/css">
			
		    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />	
			/* No style rules here yet */			
		</style>

	</head>
	<body>
	
	<!-- Add 2 buttons -->

	<div id="Gender_data"></div>
	
		<script type="text/javascript">

		var noteTypeColors = {
                "Citrus":"Orange",
                "Green":"Green",
                "Floral":"Pink",
                "Fruity":"Red",
                "Balsamic":"Purple",
                "Wooded":"Brown",
                "Gourmand":"Gray",
                "Spices":"Yellow",
            }


		// set the dimensions and margins of the graph
		var margin = {top: 20, right: 30, bottom: 40, left: 90},
			width = 500 - margin.left - margin.right,
			height = 850 - margin.top - margin.bottom;

		// append the svg object to the body of the page
		var svg = d3.select("#Gender_data")
		  .append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
		  .append("g")
			.attr("transform",
				  "translate(" + margin.left + "," + margin.top + ")");
		

			

		d3.csv("Perfume Notes - Gendered Notes.csv")
			.then(function(data){
				console.log("data:"); console.log(data)

			var x = d3.scaleLinear()
				.domain([0, 15])
				.range([ 0, width]);
			svg.append("g")
				.attr("transform", "translate(0," + height + ")")
				.call(d3.axisBottom(x))
				.selectAll("text")
				  .style("text-anchor", "end");
			// Y axis
			var y = yscale(data);
			function yscale(dataInput) {
				return d3.scaleBand()
				.range([ 0, height ])
				.domain(dataInput.map(function(d) { return d.Notes; }))
				.padding(.1);
			}
			var yaxisG = svg.append("g");
			yaxisG.call(d3.axisLeft(y))
				.on("click", null)

			//Creating Initial Bars
			  svg.selectAll("myRect")
				.data(data)
				.enter()
				.append("rect")
				.attr("x", x(0) )
				.attr("y", function(d) { return y(d.Notes); })
				.attr("width", function(d) { return x(d.Women); })
				.attr("height", y.bandwidth() )
				.attr("fill", function(d){
					console.log(noteTypeColors)
                    var color = noteTypeColors[d.Type]
					console.log(color)
						if(color ==undefined){
							color ="grey"
						}
						return color
					})
				
	//});
				//node.sort(comparator) two nodes
		//Male Dataset begins here. Trying to substitute the male data for female data. 
		//d3.select("p"
		var display = "Women"; //need to remember what is the current display
		

		var isAscending = false; //true is to sort in ascending order, false in descending order
		
		function displaySortedNotes() {
			console.log("In displaySortedNotes, event node: ");console.log(this);

			console.log("data before sort: ");console.log(data);
			var sortedData = data.slice(); //make a copy of data so the original data is not touched. Otherwise, sorting will destroy the original order of data
			sortedData.sort(function(d1, d2) {
				return (isAscending ? d1[display] - d2[display] : d2[display] - d1[display])
			})
			console.log("data after sort: ");console.log(data);
			console.log("in displaySortedNotes sortedData by: " + display);console.log(sortedData);
			var notes = d3.select(this).selectAll("text").data(sortedData).text(function(d) {
				console.log("In displaySortedNotes text: ");console.log(d.Notes);
				return d.Notes;})
			console.log("in displaySortedNotes notes: " + display);console.log(notes);
			sortedYscale = yscale(sortedData);
				//d3.scaleBand()
				//.range([ 0, height ])
				//.domain(sortedData.map(function(d) { return d.Notes; }))
				//.padding(.1);
			displayBars(sortedData, sortedYscale);
		}
		

		function displayNextType() {
			console.log("In displayNextType node: ");console.log(this);
			console.log("In displayNextType data: ");console.log(data);
			//console.log("clicked bar: ");console.log(this);
			//var dataset = data.Men
			if (display == "Women") {
				display = "Men";
			} 
			//else if (display == "Men") {
			//	display = "Women";
			//}
			displayGenderType(display)
		}

		function displayGenderType(gender) {
			var rectNode = d3.select(this);
			console.log("In displayNextType rectNode: ");console.log(rectNode);
			var notes = yaxisG.selectAll("text").data(data).text(function(d) {
				console.log("In displayNextType text: ");console.log(d.Notes);
				return d.Notes;})
			displayBars(data, y, gender); //original data
			isAscending = false;
		}

		function displayBars(displayData, newYscale, gender) {

				//Update all rects
				console.log("in displayBars. displayData for " + gender + "with isAscending " + isAscending + ":");console.log(displayData);
				svg.selectAll("rect").remove();
				//Bars
				svg.selectAll("myRect")
				.data(displayData)
				.enter()
				.append("rect")
				.attr("x", x(0) )
				.attr("y", function(d) { return newYscale(d.Notes); })
				//When I substitute dataset for d.Women, it workd fine. 
				.attr("width", function(d) { return x(d[gender]); })
				.attr("height", newYscale.bandwidth() )
				.attr("fill", function(d){
					console.log(noteTypeColors)
                    var color = noteTypeColors[d.Type]
					console.log(color)
						if(color ==undefined){
							color ="grey"
						}
						return color
					});
				svg.selectAll("rect").on("click", displayNextType);
			   //.data(dataset)
					   //.attr("y", function(d) {
					   //		return h - yScale(d);
					   //})
					   //.attr("height", function(d) {
					   //		return yScale(d);
					   //});
		}
		svg.selectAll("rect").on("click", displayNextType);

		var svg2 = d3.select("#Gender_data")
		  .append("svg")
			.attr("width", 800)
			.attr("height", 200)
		  .append("g")
		  svg2.append("text")
			.attr("x",0)
			.attr("y",0)
			.attr("font-family", Brittanic)
			.text("Women").on("click", function(){
				console.log("clickwomen")
			displayGenderType("Women")
			})
			.attr("transform",
				  "translate(" + margin.left + "," + margin.top + ")");
		  svg2.append("text")
			.attr("x",250)
			.attr("y",0)
			.text("Men").on("click", function(){
			displayGenderType("Men")
			})
			.attr("transform",
				  "translate(" + margin.left + "," + margin.top + ")");
	});		
		</script>
	</body>
</html>